import{r as o,j as e,m as k,F as P,c as M,R as te,d as se,e as U,f as D}from"./app.js";import{S as re}from"./chunk-Section.js";const $={USD:{name:"US Dollar",flag:"ðŸ‡ºðŸ‡¸"},EUR:{name:"Euro",flag:"ðŸ‡ªðŸ‡º"},JPY:{name:"Japanese Yen",flag:"ðŸ‡¯ðŸ‡µ"},CNY:{name:"Chinese Yuan",flag:"ðŸ‡¨ðŸ‡³"}},B=()=>e.jsx("div",{className:"flex justify-center items-center h-full p-8",children:e.jsx(M,{className:"w-16 h-16 text-white animate-spin"})}),ae=({currency:n,data:x})=>{const c=$[n];if(!c)return null;const m=t=>t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs("div",{className:"bg-slate-800/60 p-4 rounded-xl border border-slate-700/80 shadow-2xl flex flex-col",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4 border-b border-slate-700 pb-3",children:`${n} - ${c.name}`}),e.jsx("div",{className:"overflow-x-auto flex-grow",children:e.jsxs("table",{className:"w-full min-w-[340px] text-sm table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-600",children:[e.jsx("th",{scope:"col",className:"text-left px-1 sm:px-2 py-3 font-semibold text-slate-400 w-2/5",children:"Bank"}),e.jsx("th",{scope:"col",className:"text-right px-1 sm:px-2 py-3 font-semibold text-slate-400 w-3/10",children:"Buy"}),e.jsx("th",{scope:"col",className:"text-right px-1 sm:px-2 py-3 font-semibold text-slate-400 w-3/10",children:"Sell"})]})}),e.jsx("tbody",{children:x.rates.map(t=>e.jsxs("tr",{className:"border-b border-slate-700/50 last:border-b-0 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-1 sm:px-2 py-2 text-slate-300 font-medium break-words",children:t.bank}),e.jsx("td",{className:"px-1 sm:px-2 py-2 text-right text-slate-200",children:e.jsxs("div",{className:"flex justify-end items-center gap-1.5",children:[t.buy===x.maxBuy&&e.jsx(D,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:m(t.buy)})]})}),e.jsx("td",{className:"px-1 sm:px-2 py-2 text-right text-slate-200",children:e.jsxs("div",{className:"flex justify-end items-center gap-1.5",children:[t.sell===x.minSell&&e.jsx(D,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:m(t.sell)})]})})]},t.bank))})]})})]})},T=({title:n,list:x,updatedTime:c})=>{const m=t=>t===null?e.jsx("span",{className:"text-slate-500",children:"-"}):t.toLocaleString("vi-VN");return e.jsxs("div",{className:"bg-slate-800/60 p-4 rounded-xl border border-slate-700/80 shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-baseline items-start mb-4 border-b border-slate-700 pb-3",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-1 sm:mb-0",children:n}),e.jsxs("span",{className:"text-xs text-slate-400 text-left sm:text-right",children:["Updated: ",c?`${c} (GMT+7)`:"N/A"]})]}),e.jsx("div",{className:"overflow-x-auto flex-grow",children:e.jsxs("table",{className:"w-full min-w-[340px] text-sm table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-600",children:[e.jsx("th",{scope:"col",className:"text-left px-1 sm:px-2 py-3 font-semibold text-slate-400 w-2/5",children:"Type"}),e.jsxs("th",{scope:"col",className:"text-right px-1 sm:px-2 py-3 font-semibold text-slate-400 w-3/10",children:["Buy",e.jsx("span",{className:"block text-xs font-normal text-slate-500",children:"(VND)"})]}),e.jsxs("th",{scope:"col",className:"text-right px-1 sm:px-2 py-3 font-semibold text-slate-400 w-3/10",children:["Sell",e.jsx("span",{className:"block text-xs font-normal text-slate-500",children:"(VND)"})]})]})}),e.jsx("tbody",{children:x.prices.map(t=>e.jsxs("tr",{className:"border-b border-slate-700/50 last:border-b-0 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-1 sm:px-2 py-2 text-slate-300 font-medium break-words",children:t.name}),e.jsx("td",{className:"px-1 sm:px-2 py-2 text-right text-slate-200",children:m(t.buy)}),e.jsx("td",{className:"px-1 sm:px-2 py-2 text-right text-slate-200",children:m(t.sell)})]},t.name))})]})})]})},ie=()=>{const[n,x]=o.useState("forex"),[c,m]=o.useState(null),[t,F]=o.useState(!0),[j,C]=o.useState(null),[J,V]=o.useState(null),[g,Y]=o.useState(null),[y,L]=o.useState(!0),[w,A]=o.useState(null),[R,q]=o.useState(null),O=async()=>{F(!0),C(null);try{const s=await fetch("https://fx-rate-app.onrender.com/api/rates");if(!s.ok)throw new Error(`The exchange rate service is currently unavailable (Status: ${s.status}). Please try again later.`);const i=await s.json();if(i.status!=="success"||!i.data)throw new Error(i.message||"Failed to fetch forex rates due to an API error.");m(i.data);const r=i.timestamp;if(r){const a=new Date(r.endsWith("Z")?r:r+"Z"),p=new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Ho_Chi_Minh",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(a).replace(",","");V(p)}}catch(s){C(s.message||"An unknown error occurred while fetching forex data."),console.error("Failed to fetch forex rates:",s)}finally{F(!1)}},_=async()=>{var i;L(!0),A(null);const s=r=>{if(!r||r.trim()==="-")return null;const a=parseInt(r.replace(/,/g,""),10);return isNaN(a)?null:a*1e3};try{const a=`https://api.allorigins.win/raw?url=${encodeURIComponent("http://giavang.doji.vn/api/giavang/?api_key=258fbd2a72ce8481089d88c678e9fe4f")}`,l=await fetch(a);if(!l.ok)throw new Error(`The gold price service is currently unavailable via proxy (Status: ${l.status}). Please try again later.`);const p=await l.text(),d=new DOMParser().parseFromString(p,"application/xml");if(d.querySelector("parsererror"))throw new Error("Failed to parse gold price data from the API.");const h=Q=>{var I;const u=d.querySelector(Q),X=((I=u==null?void 0:u.querySelector("DateTime"))==null?void 0:I.textContent)||"N/A",ee=Array.from((u==null?void 0:u.querySelectorAll("Row"))||[]).map(S=>({name:S.getAttribute("Name")||"Unknown",buy:s(S.getAttribute("Buy")),sell:s(S.getAttribute("Sell"))}));return{dateTime:X,prices:ee}},f=h("DGPlist"),Z=h("JewelryList"),H=((i=d.querySelector("Source"))==null?void 0:i.textContent)||"DOJI";Y({dgpList:f,jewelryList:Z,source:H});const W=new Date,K=new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Ho_Chi_Minh",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(W).replace(",","");q(K)}catch(r){A(r.message||"An unknown error occurred while fetching gold data."),console.error("Failed to fetch gold prices:",r)}finally{L(!1)}},G=()=>{O(),_()};o.useEffect(()=>{G()},[]);const N=o.useMemo(()=>{if(!c)return{};const s=c.reduce((a,l)=>($[l.currency]&&(a[l.currency]||(a[l.currency]=[]),a[l.currency].push(l)),a),{}),i={},r={VCB:1,Agribank:2};for(const a in s){const l=s[a],p=Math.max(...l.map(d=>d.buy)),E=Math.min(...l.map(d=>d.sell));i[a]={rates:l.sort((d,v)=>{const h=r[d.bank],f=r[v.bank];return h&&f?h-f:h?-1:f?1:d.bank.localeCompare(v.bank)}),maxBuy:p,minSell:E}}return i},[c]),z=o.useMemo(()=>["USD","EUR","JPY","CNY"].filter(s=>N[s]),[N]),b=t||y;return e.jsxs(re,{title:"Forex & Gold Prices",icon:e.jsx(P,{}),children:[e.jsxs("div",{className:"flex justify-between items-center gap-4 mb-8",children:[e.jsxs("div",{className:"flex space-x-1 bg-slate-800/40 p-1 rounded-full",children:[e.jsxs("button",{onClick:()=>x("forex"),className:`relative flex items-center gap-x-2 w-full sm:w-auto px-4 py-1.5 text-sm font-semibold rounded-full focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 ${n==="forex"?"text-white":"text-slate-300 hover:text-white"}`,children:[n==="forex"&&e.jsx(k.div,{layoutId:"exchange-bubble",className:"absolute inset-0 bg-slate-700 rounded-full",transition:{type:"spring",stiffness:300,damping:25}}),e.jsx(P,{className:"relative z-10 w-5 h-5"}),e.jsx("span",{className:"relative z-10",children:"Forex"})]}),e.jsxs("button",{onClick:()=>x("gold"),className:`relative flex items-center gap-x-2 w-full sm:w-auto px-4 py-1.5 text-sm font-semibold rounded-full focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 ${n==="gold"?"text-white":"text-slate-300 hover:text-white"}`,children:[n==="gold"&&e.jsx(k.div,{layoutId:"exchange-bubble",className:"absolute inset-0 bg-slate-700 rounded-full",transition:{type:"spring",stiffness:300,damping:25}}),e.jsx(M,{className:"relative z-10 w-5 h-5"}),e.jsx("span",{className:"relative z-10",children:"Gold"})]})]}),e.jsx("button",{onClick:G,disabled:b,className:"p-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-200 hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-wait focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400",title:b?"Refreshing...":"Refresh data","aria-label":b?"Refreshing data":"Refresh data",children:e.jsx(te,{className:`w-6 h-6 ${b?"animate-spin":""}`})})]}),e.jsx(se,{mode:"wait",children:e.jsxs(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[n==="forex"&&e.jsxs("div",{children:[t&&e.jsx(B,{}),j&&e.jsxs("div",{className:"text-center p-6 bg-red-900/20 border border-red-500/30 rounded-lg",children:[e.jsx(U,{className:"w-10 h-10 text-red-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-300",children:"Could Not Load Forex Rates"}),e.jsx("p",{className:"text-red-400/80 mt-1",children:j})]}),!t&&!j&&c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-slate-400 mb-6",children:["Last updated: ",e.jsxs("span",{className:"font-semibold text-slate-300",children:[J||"N/A"," (GMT+7)"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:z.map(s=>e.jsx(ae,{currency:s,data:N[s]},s))}),e.jsxs("div",{className:"mt-8 text-xs text-slate-400 bg-slate-800/40 p-3 rounded-lg border border-slate-700/60 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-1.5",children:[e.jsx(D,{className:"w-4 h-4 text-yellow-400 shrink-0"}),e.jsx("span",{children:"indicates the best rate for you:"})]}),e.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-0.5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Highest Buy Price:"})," Best when you're ",e.jsx("strong",{className:"text-white",children:"selling"})," foreign currency."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Lowest Sell Price:"})," Best when you're ",e.jsx("strong",{className:"text-white",children:"buying"})," foreign currency."]})]})]})]})]}),n==="gold"&&e.jsxs("div",{children:[y&&e.jsx(B,{}),w&&e.jsxs("div",{className:"text-center p-6 bg-red-900/20 border border-red-500/30 rounded-lg",children:[e.jsx(U,{className:"w-10 h-10 text-red-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-300",children:"Could Not Load Gold Prices"}),e.jsx("p",{className:"text-red-400/80 mt-1",children:w})]}),!y&&!w&&g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(T,{title:"DOJI Gold (SJC)",list:g.dgpList,updatedTime:R}),e.jsx(T,{title:"Jewelry & Other Gold",list:g.jewelryList,updatedTime:R}),e.jsxs("p",{className:"text-xs text-slate-500 lg:col-span-2",children:["Source: ",g.source,". All prices are in VND."]})]})]})]},n)})]})};export{ie as default};
