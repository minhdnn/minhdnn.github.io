import{r as o,j as e,m as S,F as G,c as Y,R as Z,d as H,e as I,f as k,g as _}from"./app.js";import{S as O}from"./chunk-Section.js";const U={USD:{name:"US Dollar",flag:"ðŸ‡ºðŸ‡¸"},EUR:{name:"Euro",flag:"ðŸ‡ªðŸ‡º"},JPY:{name:"Japanese Yen",flag:"ðŸ‡¯ðŸ‡µ"},CNY:{name:"Chinese Yuan",flag:"ðŸ‡¨ðŸ‡³"}},P=()=>e.jsx("div",{className:"flex justify-center items-center h-full p-8",children:e.jsx(_,{className:"w-16 h-16 text-white animate-spin"})}),W=({currency:i,data:x})=>{const c=U[i];if(!c)return null;const m=s=>s.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs("div",{className:"bg-slate-800/60 p-4 rounded-xl border border-slate-700/80 shadow-2xl flex flex-col",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4 border-b border-slate-700 pb-3",children:`${i} - ${c.name}`}),e.jsx("div",{className:"overflow-x-auto flex-grow",children:e.jsxs("table",{className:"w-full min-w-[340px] text-sm table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-600",children:[e.jsx("th",{scope:"col",className:"text-left px-1 sm:px-2 py-3 font-semibold text-slate-400 w-2/5",children:"Bank"}),e.jsx("th",{scope:"col",className:"text-right px-1 sm:px-2 py-3 font-semibold text-slate-400 w-3/10",children:"Buy"}),e.jsx("th",{scope:"col",className:"text-right px-1 sm:px-2 py-3 font-semibold text-slate-400 w-3/10",children:"Sell"})]})}),e.jsx("tbody",{children:x.rates.map(s=>e.jsxs("tr",{className:"border-b border-slate-700/50 last:border-b-0 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-1 sm:px-2 py-2 text-slate-300 font-medium break-words",children:s.bank}),e.jsx("td",{className:"px-1 sm:px-2 py-2 text-right text-slate-200",children:e.jsxs("div",{className:"flex justify-end items-center gap-1.5",children:[s.buy===x.maxBuy&&e.jsx(k,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:m(s.buy)})]})}),e.jsx("td",{className:"px-1 sm:px-2 py-2 text-right text-slate-200",children:e.jsxs("div",{className:"flex justify-end items-center gap-1.5",children:[s.sell===x.minSell&&e.jsx(k,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:m(s.sell)})]})})]},s.bank))})]})})]})},A=({title:i,list:x,updatedTime:c})=>{const m=s=>s===null?e.jsx("span",{className:"text-slate-500",children:"-"}):s.toLocaleString("vi-VN");return e.jsxs("div",{className:"bg-slate-800/60 p-4 rounded-xl border border-slate-700/80 shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-baseline items-start mb-4 border-b border-slate-700 pb-3",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-1 sm:mb-0",children:i}),e.jsxs("span",{className:"text-xs text-slate-400 text-left sm:text-right",children:["Updated: ",c?`${c} (GMT+7)`:"N/A"]})]}),e.jsx("div",{className:"overflow-x-auto flex-grow",children:e.jsxs("table",{className:"w-full min-w-[340px] text-sm table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-600",children:[e.jsx("th",{scope:"col",className:"text-left px-1 sm:px-2 py-3 font-semibold text-slate-400 w-2/5",children:"Type"}),e.jsxs("th",{scope:"col",className:"text-right px-1 sm:px-2 py-3 font-semibold text-slate-400 w-3/10",children:["Buy",e.jsx("span",{className:"block text-xs font-normal text-slate-500",children:"(VND)"})]}),e.jsxs("th",{scope:"col",className:"text-right px-1 sm:px-2 py-3 font-semibold text-slate-400 w-3/10",children:["Sell",e.jsx("span",{className:"block text-xs font-normal text-slate-500",children:"(VND)"})]})]})}),e.jsx("tbody",{children:x.prices.map(s=>e.jsxs("tr",{className:"border-b border-slate-700/50 last:border-b-0 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-1 sm:px-2 py-2 text-slate-300 font-medium break-words",children:s.name}),e.jsx("td",{className:"px-1 sm:px-2 py-2 text-right text-slate-200",children:m(s.buy)}),e.jsx("td",{className:"px-1 sm:px-2 py-2 text-right text-slate-200",children:m(s.sell)})]},s.name))})]})})]})},K=()=>{const[i,x]=o.useState("forex"),[c,m]=o.useState(null),[s,D]=o.useState(!0),[j,F]=o.useState(null),[B,T]=o.useState(null),[f,M]=o.useState(null),[y,C]=o.useState(!0),[w,R]=o.useState(null),[L,$]=o.useState(null),V=async()=>{D(!0),F(null);try{const d=await fetch("https://fx-rate-app.onrender.com/api/rates");if(!d.ok)throw new Error(`The exchange rate service is currently unavailable (Status: ${d.status}). Please try again later.`);const t=await d.json();if(t.status!=="success"||!t.data)throw new Error(t.message||"Failed to fetch forex rates due to an API error.");m(t.data);const l=t.timestamp;if(l){const n=new Date(l.endsWith("Z")?l:l+"Z"),h=new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Ho_Chi_Minh",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(n).replace(",","");T(h)}}catch(r){F(r.message||"An unknown error occurred while fetching forex data."),console.error("Failed to fetch forex rates:",r)}finally{D(!1)}},z=async()=>{C(!0),R(null);try{const d=await fetch("https://fx-rate-app.onrender.com/api/gold");if(!d.ok)throw new Error(`The gold price service is currently unavailable (Status: ${d.status}). Please try again later.`);const t=await d.json();if(t.status!=="success"||!t.categorized)throw new Error("Failed to fetch gold prices due to an API error.");const l=h=>h.map(a=>{const u=a.unit.includes("x1000")?1e3:1;let p=a.name;return a.name==="DOJI HCM láº»"||a.name==="DOJI HCM buÃ´n"?p=`${a.name} (chá»‰)`:a.unit==="VND/gram"&&(p=`${a.name} (VND/gram)`),{name:p,buy:a.buy*u,sell:a.sell>0?a.sell*u:null}}),n={dateTime:t.timestamp,prices:l(t.categorized.domestic)},b={dateTime:t.timestamp,prices:l(t.categorized.gold_jewelry)};if(M({dgpList:n,jewelryList:b,source:"FX Rate App API"}),t.timestamp){const h=new Date(t.timestamp.endsWith("Z")?t.timestamp:t.timestamp+"Z"),u=new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Ho_Chi_Minh",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(h).replace(",","");$(u)}}catch(r){R(r.message||"An unknown error occurred while fetching gold data."),console.error("Failed to fetch gold prices:",r)}finally{C(!1)}},E=()=>{V(),z()};o.useEffect(()=>{E()},[]);const N=o.useMemo(()=>{if(!c)return{};const r=c.reduce((l,n)=>(U[n.currency]&&(l[n.currency]||(l[n.currency]=[]),l[n.currency].push(n)),l),{}),d={},t={VCB:1,Agribank:2};for(const l in r){const n=r[l],b=Math.max(...n.map(a=>a.buy)),h=Math.min(...n.map(a=>a.sell));d[l]={rates:n.sort((a,u)=>{const p=t[a.bank],v=t[u.bank];return p&&v?p-v:p?-1:v?1:a.bank.localeCompare(u.bank)}),maxBuy:b,minSell:h}}return d},[c]),J=o.useMemo(()=>["USD","EUR","JPY","CNY"].filter(r=>N[r]),[N]),g=s||y;return e.jsxs(O,{title:"Forex & Gold Prices",icon:e.jsx(G,{}),children:[e.jsxs("div",{className:"flex justify-between items-center gap-4 mb-8",children:[e.jsxs("div",{className:"flex space-x-1 bg-slate-800/40 p-1 rounded-full",children:[e.jsxs("button",{onClick:()=>x("forex"),className:`relative flex items-center gap-x-2 w-full sm:w-auto px-4 py-1.5 text-sm font-semibold rounded-full focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 ${i==="forex"?"text-white":"text-slate-300 hover:text-white"}`,children:[i==="forex"&&e.jsx(S.div,{layoutId:"exchange-bubble",className:"absolute inset-0 bg-slate-700 rounded-full",transition:{type:"spring",stiffness:300,damping:25}}),e.jsx(G,{className:"relative z-10 w-5 h-5"}),e.jsx("span",{className:"relative z-10",children:"Forex"})]}),e.jsxs("button",{onClick:()=>x("gold"),className:`relative flex items-center gap-x-2 w-full sm:w-auto px-4 py-1.5 text-sm font-semibold rounded-full focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 ${i==="gold"?"text-white":"text-slate-300 hover:text-white"}`,children:[i==="gold"&&e.jsx(S.div,{layoutId:"exchange-bubble",className:"absolute inset-0 bg-slate-700 rounded-full",transition:{type:"spring",stiffness:300,damping:25}}),e.jsx(Y,{className:"relative z-10 w-5 h-5"}),e.jsx("span",{className:"relative z-10",children:"Gold"})]})]}),e.jsx("button",{onClick:E,disabled:g,className:"p-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-200 hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-wait focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400",title:g?"Refreshing...":"Refresh data","aria-label":g?"Refreshing data":"Refresh data",children:e.jsx(Z,{className:`w-6 h-6 ${g?"animate-spin":""}`})})]}),e.jsx(H,{mode:"wait",children:e.jsxs(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[i==="forex"&&e.jsxs("div",{children:[s&&e.jsx(P,{}),j&&e.jsxs("div",{className:"text-center p-6 bg-red-900/20 border border-red-500/30 rounded-lg",children:[e.jsx(I,{className:"w-10 h-10 text-red-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-300",children:"Could Not Load Forex Rates"}),e.jsx("p",{className:"text-red-400/80 mt-1",children:j})]}),!s&&!j&&c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-slate-400 mb-6",children:["Last updated: ",e.jsxs("span",{className:"font-semibold text-slate-300",children:[B||"N/A"," (GMT+7)"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:J.map(r=>e.jsx(W,{currency:r,data:N[r]},r))}),e.jsxs("div",{className:"mt-8 text-xs text-slate-400 bg-slate-800/40 p-3 rounded-lg border border-slate-700/60 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-1.5",children:[e.jsx(k,{className:"w-4 h-4 text-yellow-400 shrink-0"}),e.jsx("span",{children:"indicates the best rate for you:"})]}),e.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-0.5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Highest Buy Price:"})," Best when you're ",e.jsx("strong",{className:"text-white",children:"selling"})," foreign currency."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Lowest Sell Price:"})," Best when you're ",e.jsx("strong",{className:"text-white",children:"buying"})," foreign currency."]})]})]})]})]}),i==="gold"&&e.jsxs("div",{children:[y&&e.jsx(P,{}),w&&e.jsxs("div",{className:"text-center p-6 bg-red-900/20 border border-red-500/30 rounded-lg",children:[e.jsx(I,{className:"w-10 h-10 text-red-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-300",children:"Could Not Load Gold Prices"}),e.jsx("p",{className:"text-red-400/80 mt-1",children:w})]}),!y&&!w&&f&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(A,{title:"Domestic Gold (SJC, etc.)",list:f.dgpList,updatedTime:L}),e.jsx(A,{title:"Jewelry & Other Gold",list:f.jewelryList,updatedTime:L}),e.jsxs("p",{className:"text-xs text-slate-500 lg:col-span-2",children:["Source: ",f.source,". All prices are in VND."]})]})]})]},i)})]})};export{K as default};
